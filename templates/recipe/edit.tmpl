{{ define "content-recipe/edit" }}
<section id="edit-recipe-container" class="container">
    <header class="row">
        <h4>{{if .Recipe}}Edit{{else}}Add{{end}} Recipe</h4>
    </header>
    <form method="post" action="{{RootUrlPath}}/recipes/{{.Recipe.ID}}">
        <div class="row">
            <div class="input-field col s12 l12">
                <input id="name" name="name" class="validate" placeholder="(e.g., Fried Chicken)" value="{{.Recipe.Name}}" required autofocus>
                <label for="name" class="active">Name *</label>
            </div>
            <div class="input-field col s12 l12">
                <textarea id="serving-size" name="serving-size" class="materialize-textarea" placeholder="(e.g., 2)">{{.Recipe.ServingSize}}</textarea>
                <label for="serving-size" class="active">Serving Size</label>
            </div>
            <div class="input-field col s12 l12">
                <textarea id="ingredients" name="ingredients" class="materialize-textarea" placeholder="List of each ingredient, optionally separated into sections (e.g., Marinade)." required>{{.Recipe.Ingredients}}</textarea>
                <label for="ingredients" class="active">Ingredients *</label>
            </div>
            <div class="input-field col s12 l12">
                <textarea id="directions" name="directions" class="materialize-textarea" placeholder="Step-by-step directions to follow to make the dish." required>{{.Recipe.Directions}}</textarea>
                <label for="directions" class="active">Directions *</label>
            </div>
            <div class="input-field col s12 l12">
                <textarea id="nutrition-info" name="nutrition-info" class="materialize-textarea" placeholder="(e.g., 100 Calories, 2g Fat)">{{.Recipe.NutritionInfo}}</textarea>
                <label for="nutrition-info" class="active">Nutrition</label>
            </div>
            <div class="input-field col s12 l12">
                <input id="source" name="source" placeholder="(e.g., http://www.example.com/recipes/fried-chicken)" value="{{.Recipe.SourceURL}}">
                <label for="source" class="active">Source</label>
            </div>
            <div id="tags" class="input-field col s12 l12">
                <div class="chips"></div>
            </div>
            <div class="input-field col s12 l12">
                <div><label class="active">Suggested Tags</label></div>
                {{range .SuggestedTags}}
                <span class="chip green lighten-5 green-text text-darken-4" data-tag="{{.}}">{{.}}<i class="material-icons close add">add</i></span>
                {{end}}
            </div>
        </div>
        <div class="center">
            <button type="submit" class="btn waves-effect">
                Save
                <i class="material-icons right">save</i>
            </button>
            <button type="button" class="btn waves-effect" onclick="history.back();">
                Cancel
                <i class="material-icons right">cancel</i>
            </button>
        </div>
    </form>
</section>
{{ end }}

{{ define "js-recipe/edit" }}
<script type="text/javascript">
$(document).ready(function(){
    var $tagDiv = $('#tags');
    var $tagChips = $tagDiv.find('.chips');
    
    $tagChips.material_chip({
        data: [
            {{range .Recipe.Tags}}{tag: '{{.}}'},
            {{end}}
        ],
        placeholder: '+tag',
        secondaryPlaceholder: '+tag',
    });
    $tagChips.find('.chip').each(function() {
        $tagDiv.append('<input name="tags" type="hidden" value="' + $(this).contents().first().text() + '">');
    });
    $tagChips.on('chip.add', function(e, chip) {
        $tagDiv.append('<input name="tags" type="hidden" value="' + chip.tag + '">');
    });
    $tagChips.on('chip.delete', function(e, chip) {
        $tagDiv.find('input[value="' + chip.tag + '"]').remove();
    });

    var $tagInput = $tagDiv.find('.chips > input');
    $tagInput.keyup(function(){
        this.value = this.value.toLowerCase();
    });
    $tagInput.after('<label class="active">Tags</label>');

    var $addChip = $('.chip .add');
    $addChip.on('click', function() {
        var tagData = $(this).closest('.chip').data('tag');
        $tagInput.val(tagData);
        var e = jQuery.Event('keydown');
        e.which = 13;
        e.keyCode = 13;
        $tagInput.trigger(e);
    });
});
</script>
{{ end }}
