{{ define "css-recipe/view" }}
<style>
    .image-container {
        position: relative;
    }
    
    .delete-image {
        position: absolute;
        top: -20px;
        right: 15px;
    }
</style>
{{ end }}

{{ define "content-recipe/view" }}
<section class="row">
    <article class="col s12 m12 l10 offset-l1">
        <section class="card grey lighten-4">
            <div class="card-content">
                <form id="rating-form" class="rating-container clickable" method="post" action="{{RootUrlPath}}/recipes/{{.Recipe.ID}}/rate">
                    <a href="javascript:void(0)" class="whole {{if eq .Recipe.AvgRating 5.0}}active{{end}}" data-rating="5.0"><i class="material-icons">star</i></a>
                    <a href="javascript:void(0)" class="half {{if eq .Recipe.AvgRating 4.5}}active{{end}}" data-rating="4.5"><i class="material-icons">star</i></a>
                    <a href="javascript:void(0)" class="whole {{if eq .Recipe.AvgRating 4.0}}active{{end}}" data-rating="4.0"><i class="material-icons">star</i></a>
                    <a href="javascript:void(0)" class="half {{if eq .Recipe.AvgRating 3.5}}active{{end}}" data-rating="3.5"><i class="material-icons">star</i></a>
                    <a href="javascript:void(0)" class="whole {{if eq .Recipe.AvgRating 3.0}}active{{end}}" data-rating="3.0"><i class="material-icons">star</i></a>
                    <a href="javascript:void(0)" class="half {{if eq .Recipe.AvgRating 2.5}}active{{end}}" data-rating="2.5"><i class="material-icons">star</i></a>
                    <a href="javascript:void(0)" class="whole {{if eq .Recipe.AvgRating 2.0}}active{{end}}" data-rating="2.0"><i class="material-icons">star</i></a>
                    <a href="javascript:void(0)" class="half {{if eq .Recipe.AvgRating 1.5}}active{{end}}" data-rating="1.5"><i class="material-icons">star</i></a>
                    <a href="javascript:void(0)" class="whole {{if eq .Recipe.AvgRating 1.0}}active{{end}}" data-rating="1.0"><i class="material-icons">star</i></a>
                    <a href="javascript:void(0)" class="half {{if eq .Recipe.AvgRating 0.5}}active{{end}}" data-rating="0.5"><i class="material-icons">star</i></a>
                    <input id="rating-input" name="rating" type="hidden">
                </form>
                <h4>
                    {{if .Recipe.Image}}
                    <img src="{{RootUrlPath}}{{.Recipe.Image}}" class="circle" style="width: 64px; height: 64px;">
                    {{end}}
                    {{.Recipe.Name}}
                </h4>
                {{if .Recipe.ServingSize}}
                <label>Serving Size</label>
                <p class="section plain-text">{{.Recipe.ServingSize}}</p>
                <div class="divider"></div>
                {{end}}
                <label>Ingredients</label>
                <p class="section plain-text">{{.Recipe.Ingredients}}</p>
                <div class="divider"></div>
                <label>Directions</label>
                <p class="section plain-text">{{.Recipe.Directions}}</p>
                {{if .Recipe.NutritionInfo}}
                <div class="divider"></div>
                <label>Nutrition</label>
                <p class="section plain-text">{{.Recipe.NutritionInfo}}</p>
                {{end}}
                {{if .Recipe.Tags}}
                <div class="divider"></div>
                <p class="section">
                    {{range .Recipe.Tags}}
                    <div class="chip">
                        {{.}}
                    </div>
                    {{end}}
                </p>
                {{end}}
            </div>
        </section>
        <section>
            <article class="col s12 l6">
                <h5 class="light">Pictures</h5>
                <div class="divider"></div>
                <section class="section">
                    {{range .Images}}
                    <span class="image-container">
                        <a target="_blank" href="{{RootUrlPath}}{{.URL}}">
                            {{if .ThumbnailURL}}
                            <img width="250" height="250" src="{{RootUrlPath}}{{.ThumbnailURL}}">
                            {{else}}
                            <img width="250" height="250" src="{{RootUrlPath}}{{.URL}}">
                            {{end}}
                        </a>
                        <a class="delete-image" href="javascript:void(0)" data-image-name="{{.Name}}">
                            <i class="material-icons red-text">delete</i>
                        </a>
                    </span>
                    {{end}}
                </section>
            </article>
            <article class="col s12 l6">
                <h5 class="light">Notes</h5>
                <div class="divider"></div>
                {{range .Notes}}
                <section class="card grey lighten-4">
                    <div class="card-content">
                        <p class="section left">
                            <i class="material-icons left">comment</i>
                            {{.CreatedAt.Format "2006 Jan 02, 03:04:05PM"}}
                        </p>
                        <p class="section right">
                            <a class="edit-note" href="javascript:void(0)" data-note-id="{{.ID}}" data-note-content="{{QueryEscape .Note}}">
                                <i class="material-icons amber-text text-darken-2">edit</i>
                            </a>
                            <a class="delete-note" href="javascript:void(0)" data-note-id="{{.ID}}">
                                <i class="material-icons red-text">delete</i>
                            </a>
                        </p>
                        <div class="divider clearfix"></div>
                        <p class="section plain-text">{{.Note}}</p>
                        {{if not (TimeEqual .CreatedAt .ModifiedAt)}}
                        <label class="right">Modified: {{.ModifiedAt.Format "2006 Jan 02, 03:04:05PM"}}</label>
                        {{end}}
                    </div>
                </section>
                {{end}}
            </article>
        </section>
    </article>
</section>
<section class="fixed-action-btn">
    <a class="btn-floating btn-large waves-effect blue">
        <i class="material-icons">more_vert</i>
    </a>
    <ul>
        <li>
            <a href="{{RootUrlPath}}/recipes/create" class="btn-floating waves-effect green">
                <i class="material-icons">add</i>
            </a>
        </li>
        <li>
            <a href="#delete-confirm" class="btn-floating waves-effect red modal-trigger">
                <i class="material-icons">delete</i>
            </a>
        </li>
        <li>
            <a href="{{RootUrlPath}}/recipes/{{.Recipe.ID}}/edit" class="btn-floating waves-effect amber darken-2">
                <i class="material-icons">mode_edit</i>
            </a>
        </li>
        <li>
            <a href="#add-image-modal" class="btn-floating waves-effect green modal-trigger">
                <i class="material-icons">add_a_photo</i>
            </a>
        </li>
        <li>
            <a id="add-note" href="javascript:void(0)" class="btn-floating waves-effect blue">
                <i class="material-icons">insert_comment</i>
            </a>
        </li>
    </ul>
</section>
<div id="delete-confirm" class="modal">
    <div class="modal-content">
        <h5 class="red-text"><i class="material-icons left">warning</i>Delete?</h5>
        <p>Are you sure you want to delete this recipe?</p>
    </div>
    <div class="modal-footer">
        <a href="javascript:void(0)" class="modal-action modal-close btn-flat">No</a>
        <a href="{{RootUrlPath}}/recipes/{{.Recipe.ID}}/delete" class="modal-action modal-close btn-flat">Yes</a>
    </div>
</div>
<div id="add-image-modal" class="modal">
    <form action="{{RootUrlPath}}/recipes/{{.Recipe.ID}}/attach" method="post" enctype="multipart/form-data">
        <div class="modal-content">
            <h5 class="green-text"><i class="material-icons left">add_a_photo</i>Attach Image</h5>
            <p>Browse to an image file to attach to this recipe.<p>
            <div class="input-field file-field">
                <div class="btn">
                    <span>File</span>
                    <input name="file_content" type="file">
                </div>
                <div class="file-path-wrapper">
                    <input name="file_name" class="file-path">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:void(0)" class="modal-action modal-close btn-flat">Cancel</a>
            <button type="submit" class="modal-action modal-close btn-flat">Attach</button>
        </div>
    </form>
</div>
<div id="delete-image-confirm" class="modal">
    <div class="modal-content">
        <h5 class="red-text"><i class="material-icons left">warning</i>Delete?</h5>
        <p>Are you sure you want to delete this image?</p>
    </div>
    <div class="modal-footer">
        <a href="javascript:void(0)" class="modal-action modal-close btn-flat">No</a>
        <a id="delete-image-yes" class="modal-action modal-close btn-flat">Yes</a>
    </div>
</div>
<div id="note-modal" class="modal">
    <form method="post">
        <div class="modal-content">
            <h5 class="blue-text">
                <i class="material-icons left">insert_comment</i><span id="note-title">Add Note</span>
            </h5>
            <div class="input-field">
                <textarea id="note" name="note" class="materialize-textarea" required autofocus></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <a href="javascript:void(0)" class="modal-action modal-close btn-flat">Cancel</a>
            <button id="note-submit" type="submit" class="modal-action modal-close btn-flat">Add</button>
        </div>
    </form>
</div>
<div id="delete-note-confirm" class="modal">
    <div class="modal-content">
        <h5 class="red-text"><i class="material-icons left">warning</i>Delete?</h5>
        <p>Are you sure you want to delete this note?</p>
    </div>
    <div class="modal-footer">
        <a href="javascript:void(0)" class="modal-action modal-close btn-flat">No</a>
        <a id="delete-note-yes" class="modal-action modal-close btn-flat">Yes</a>
    </div>
</div>
{{ end }}

{{ define "js-recipe/view" }}
<script type="text/javascript">
    $('#rating-form > a').click(function() {
        $('#rating-input').val($(this).data('rating'));
        $('#rating-form').submit();
    });
    
    $('.delete-image').click(function() {
        var name = $(this).data('image-name');
        $('#delete-image-yes').attr('href', '{{RootUrlPath}}/recipes/{{.Recipe.ID}}/attach/' + name + '/delete');
        $('#delete-image-confirm').openModal();
    });
    
    $('#add-note').click(function() {
        $('#note-modal > form').attr('action', '{{RootUrlPath}}/recipes/{{.Recipe.ID}}/note');
        $('#note').val('');
        $('#note-title').text('Add Note');
        $('#note-submit').text('Add');
        $('#note-modal').openModal();
    });
    
    $('.edit-note').click(function() {
        var noteID = $(this).data('note-id');
        var noteContent = $(this).data('note-content');
        noteContent = noteContent.replace(/\+/g, ' ');
        noteContent = decodeURIComponent(noteContent);
        $('#note-modal > form').attr('action', '{{RootUrlPath}}/recipes/{{.Recipe.ID}}/note/' + noteID);
        $('#note').val(noteContent);
        $('#note-title').text('Edit Note');
        $('#note-submit').text('Update');
        $('#note-modal').openModal();
    });
    
    $('.delete-note').click(function() {
        var noteID = $(this).data('note-id');
        $('#delete-note-yes').attr('href', '{{RootUrlPath}}/recipes/{{.Recipe.ID}}/note/' + noteID + '/delete');
        $('#delete-note-confirm').openModal();
    });
</script>
{{ end }}
