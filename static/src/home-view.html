<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">

<link rel="import" href="mixins/gomp-core-mixin.html">

<link rel="import" href="components/home-list.html">

<link rel="import" href="shared-styles.html">

<dom-module id="home-view">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }
            section {
                padding: 8px;
            }
            header {
                text-align: center;
            }
            img.responsive {
                max-height: 20em;
                max-width: 100%;
                height: auto;
            }
            paper-fab.green {
                --paper-fab-background: var(--paper-green-500);
                --paper-fab-keyboard-focus-background: var(--paper-green-900);
                position: fixed;
                bottom: 16px;
                right: 16px;
            }
        </style>
        <section>
            <header>
                <h1 hidden$="[[!title]]">[[title]]</h1>
                <img alt="Home Image" class="responsive" hidden$="[[!image]]" src="[[image]]"/>
            </header>
            <home-list id="allRecipes"></home-list>
            <home-list id="beefRecipes" title="Beef" tags='["beef","steak"]'></home-list>
            <home-list id="poultryRecipes" title="Poultry" tags='["chicken","turkey","poultry"]'></home-list>
            <home-list id="seafoodRecipes" title="Seafood" tags='["seafood","fish"]'></home-list>
            <home-list id="porkRecipes" title="Pork" tags='["pork"]'></home-list>
            <home-list id="pastaRecipes" title="Pasta" tags='["pasta"]'></home-list>
            <home-list id="vegetarianRecipes" title="Vegetarian" tags='["vegetarian"]'></home-list>
            <home-list id="sideRecipes" title="Sides" tags='["side","sides"]'></home-list>
            <home-list id="drinkRecipes" title="Drinks" tags='["drink","cocktail"]'></home-list>
        </section>

        <a href="/create"><paper-fab icon="icons:add" class="green"></paper-fab></a>

        <iron-ajax bubbles
            id="userSettingsAjax"
            url="/api/v1/users/current/settings"
            on-response="_handleGetUserSettingsResponse"></iron-ajax>
    </template>

    <script>
        class HomeView extends GompCoreMixin(Polymer.GestureEventListeners(Polymer.Element)) {
            static get is() { return 'home-view'; }
            static get properties() {
                return {
                    title: {
                        type: String,
                        notify: true,
                    },
                    image: {
                        type: String,
                        notify: true,
                    },
                };
            }

            ready() {
                super.ready();

                if (this.isActive) {
                    this._refresh();
                }
            }

            _isActiveChanged(isActive) {
                if (isActive && this.isReady) {
                    this._refresh();
                }
            }
            _handleGetUserSettingsResponse(e) {
                var userSettings = e.detail.response;

                this.title = userSettings.homeTitle;
                this.image = userSettings.homeImageUrl;
            }

            _refresh() {
                this.$.allRecipes.refresh();
                this.$.beefRecipes.refresh();
                this.$.poultryRecipes.refresh();
                this.$.porkRecipes.refresh();
                this.$.seafoodRecipes.refresh();
                this.$.pastaRecipes.refresh();
                this.$.vegetarianRecipes.refresh();
                this.$.sideRecipes.refresh();
                this.$.drinkRecipes.refresh();
                this.$.userSettingsAjax.generateRequest();
            }
        }

        window.customElements.define(HomeView.is, HomeView);
    </script>
</dom-module>
