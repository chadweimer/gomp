<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">

<dom-module id="recipes-view">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>

        <app-route
            route="{{route}}"
            pattern="/:recipeId"
            data="{{routeData}}"
            tail="{{subroute}}"></app-route>
        <iron-pages
            selected="[[page]]"
            attr-for-selected="name"
            role="main">
            <recipes-list-view name="recipes-list" search="{{search}}"></recipes-list-view>
            <recipe-view name="recipe" recipe-id="{{recipeId}}"></recipe-view>
        </iron-pages>
    </template>

    <script>
        Polymer({

            is: 'recipes-view',

            properties: {
                route: {
                    type: Object,
                    notify: true
                },
                recipeId: {
                    type: String,
                    notify: true
                },
                page: {
                    type: String,
                    reflectToAttribute: true,
                    observer: '_pageChanged'
                },
                search: {
                    type: String,
                    value: null,
                    notify: true
                }
            },

            observers: [
                '_recipeIdChanged(routeData.recipeId)',
                '_routeChanged(route)'
            ],
            _recipeIdChanged: function(recipeId) {
                this.recipeId = recipeId;
                if (this.recipeId) {
                    this.page = "recipe";
                } else {
                    this.page = "recipes-list";
                }
            },
            _routeChanged: function(route) {
                if (route.path === '') {
                    this.page = "recipes-list";
                }
            },
            _pageChanged: function(page) {
                // Load page import on demand. Show 404 page if fails
                var resolvedPageUrl = this.resolveUrl(page + '-view.html');
                this.importHref(resolvedPageUrl, null, null, true);
            }

        });
    </script>
</dom-module>
