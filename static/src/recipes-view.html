<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">

<dom-module id="recipes-view">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>

        <app-route id="appRoute" route="{{route}}" pattern="/:recipeId" data="{{routeData}}" tail="{{subroute}}"></app-route>
        <iron-pages selected="[[page]]" attr-for-selected="name">
            <recipes-list-view
                name="recipes-list"
                jwt-token="[[jwtToken]]"
                active="[[_isActive(page, 'recipes-list')]]"
                search="{{search}}"
                search-tags="{{searchTags}}"></recipes-list-view>

            <recipe-view
                name="recipe"
                jwt-token="[[jwtToken]]"
                active="[[_isActive(page, 'recipe')]]"
                recipe-id="{{recipeId}}"></recipe-view>
        </iron-pages>
    </template>

    <script>
        Polymer({

            is: 'recipes-view',

            properties: {
                active: {
                    type: Boolean,
                    notify: true,
                    value: false
                },
                jwtToken: {
                    type: String,
                    notify: true
                },
                route: {
                    type: Object,
                    notify: true
                },
                search: {
                    type: String,
                    value: null,
                    notify: true
                },
                searchTags: {
                    type: Array,
                    value: [],
                    notify: true
                },
            },

            observers: [
                '_recipeIdChanged(routeData.recipeId)',
                '_pageChanged(page)',
                '_routeChanged(route)'
            ],
            _recipeIdChanged: function(recipeId) {
                this.recipeId = recipeId;
                this.page = "recipe";
            },
            _routeChanged: function(route) {
                if (route.path === '') {
                    this.recipeId = null;
                    this.page = "recipes-list";
                }
            },
            _pageChanged: function(page) {
                // Load page import on demand. Show 404 page if fails
                var resolvedPageUrl = this.resolveUrl(page + '-view.html');
                this.importHref(resolvedPageUrl, null, null, true);
            },
            _isActive: function(currentPage, pageToCheck) {
                return this.active && currentPage === pageToCheck;
            }

        });
    </script>
</dom-module>
