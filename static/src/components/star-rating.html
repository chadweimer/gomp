<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">

<link rel="import" href="../shared-styles.html">

<dom-module id="star-rating">
    <template>
        <style include="shared-styles">
            :host {
                display: inline-block;
                cursor: pointer;
                --iron-icon-width: var(--star-rating-size, 24px);
                --iron-icon-height: var(--star-rating-size, 24px);
            }
            iron-icon {
                color: var(--paper-grey-200);
                float: right;
            }
            iron-icon.whole {
                -webkit-clip-path: inset(0 0 0 50%);
                   -moz-clip-path: inset(0 0 0 50%);
                    -ms-clip-path: inset(0 0 0 50%);
                     -o-clip-path: inset(0 0 0 50%);
                        clip-path: inset(0 0 0 50%);
                position: relative;
                left: calc(var(--iron-icon-width) * -1);
                margin-right: calc(var(--iron-icon-width) * -1);
            }
            iron-icon.half {
                -webkit-clip-path: inset(0 50% 0 0);
                   -moz-clip-path: inset(0 50% 0 0);
                    -ms-clip-path: inset(0 50% 0 0);
                     -o-clip-path: inset(0 50% 0 0);
                        clip-path: inset(0 50% 0 0);
                position: relative;
            }
            iron-icon.active,
            iron-icon.active ~ iron-icon {
                color: var(--paper-yellow-600);
            }
            iron-icon:hover,
            iron-icon:hover ~ iron-icon {
                color: var(--paper-yellow-500) !important;
            }
        </style>
        
        <iron-icon icon="icons:star" class="whole" data-rating="5"></iron-icon>
        <iron-icon icon="icons:star" class="half" data-rating="4.5"></iron-icon>
        <iron-icon icon="icons:star" class="whole" data-rating="4"></iron-icon>
        <iron-icon icon="icons:star" class="half" data-rating="3.5"></iron-icon>
        <iron-icon icon="icons:star" class="whole" data-rating="3"></iron-icon>
        <iron-icon icon="icons:star" class="half" data-rating="2.5"></iron-icon>
        <iron-icon icon="icons:star" class="whole" data-rating="2"></iron-icon>
        <iron-icon icon="icons:star" class="half" data-rating="1.5"></iron-icon>
        <iron-icon icon="icons:star" class="whole" data-rating="1"></iron-icon>
        <iron-icon icon="icons:star" class="half" data-rating="0.5"></iron-icon>
    </template>

    <script>
        Polymer({

            is: 'star-rating',

            properties: {
                value: {
                    type: Number,
                    notify: true,
                    value: 0,
                    observer: '_valueChanged'
                }
            },

            ready: function() {
                var self = this;
                var stars = Polymer.dom(this.root).querySelectorAll("iron-icon");
                stars.forEach(function(star) {
                    self.listen(star, 'tap', '_starTapped');
                });
            },

            _valueChanged: function(newValue, oldValue) {
                if (newValue !== 0 && !newValue) {
                    return
                }

                var stars = Polymer.dom(this.root).querySelectorAll("iron-icon");
                stars.forEach(function(star) {
                    if (star.dataset.rating === newValue.toString()) {
                        star.classList.add("active");
                    } else {
                        star.classList.remove("active");
                    }
                });
            },

            _starTapped: function(e) {
                e.preventDefault();

                this.fire("star-rating-selected", {rating: e.target.dataset.rating});
            }
        });
    </script>
</dom-module>